---
http:
  routers:
    s3-hash-file-router:
      rule: 'Path("/.well-known/fastly/logging/challenge")'
      service: s3-hash-file-service
      middlewares:
      - "remove-auth"
      tls:
      - certFile: "/etc/traefik/odl_wildcard.cert"
        keyFile: "/etc/traefik/odl_wildcard.key"
    vector-router:
      rule: 'Host("{{ env "DOMAIN" }}") && Path("/")'
      service: vector-service
      tls:
      - certFile: "/etc/traefik/odl_wildcard.cert"
        keyFile: "/etc/traefik/odl_wildcard.key"
  middlewares:
    remove-auth:
      headers:
        customRequestHeaders:
          Authorization: ""
          Host: '{{ env "FASTLY_SERVICE_HASH_BUCKET_FQDN" }}'
  serversTransports:
    vector-transport:
      insecureSkipVerify: true
    s3-hash-transport:
      insecureSkipVerify: false
  services:
    vector-service:
      loadBalancer:
        servers:
        - url: https://localhost:9443
        serversTransport: vector-transport
    s3-hash-file-service:
      loadBalancer:
        servers:
        - url: '{{ env "FASTLY_SERVICE_HASH_BUCKET_CHALLENGE_URL" }}'
        serversTransport: s3-hash-transport
