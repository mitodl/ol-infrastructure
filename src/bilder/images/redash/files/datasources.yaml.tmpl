{{ $environment := env "ENVIRONMENT" }}
managed_datasources:
{{ if eq $environment "data-qa" }}
- name: "MITx Online RC"
  type: pg
  options:
    dbname: "mitxonline"
    host: '{{ keyOrDefault "redash/datasource_configs/mitxonline-rc/db_host" "missing" }}'
    password: '{{ with secret "postgres-mitxonline/creds/readonly" }}{{ .Data.password }}'
    port: 5432
    sslmode: "require"
    user: '{{ .Data.username }}{{ end }}'
{{ end }}
{{ if eq $environment "data-production" }}
- name: "MITx Online Production"
  type: pg
  options:
    dbname: "mitxonline"
    host: '{{ keyOrDefault "redash/datasource_configs/mitxonline-production/db_host" "missing" }}'
    password: '{{ with secret "postgres-mitxonline/creds/readonly" }}{{ .Data.password }}'
    port: 5432
    sslmode: "require"
    user: '{{ .Data.username }}{{ end }}'
{{ end }}
