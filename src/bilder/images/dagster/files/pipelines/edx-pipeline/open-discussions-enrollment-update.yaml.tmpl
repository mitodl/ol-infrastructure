{{- $env := ( key "edx-pipeline/shared/env-suffix" ) -}}
resources:
  athena_db:
    config:
      schema_name: ol_warehouse_mit_open_{{ keyOrDefault "edx-pipeline/shared/env-suffix" "missing-value-env-suffix" }}
      work_group: ol-warehouse-{{ keyOrDefault "edx-pipeline/shared/env-suffix" "missing-value-env-suffix" }}
  postgres_db:
    config:
      postgres_db_name: opendiscussions
      postgres_hostname: {{ keyOrDefault "edx-pipeline/mit-open/postgres-db/hostname" "missing-value-postgres-db-hostname" }}
      {{- if eq $env "qa" }}
      postgres_username: {{ with secret "postgres-rc-apps-opendiscussions/creds/opendiscussions" }}{{ .Data.username }}
      postgres_password: {{ .Data.password }}{{ end }}
      {{- end }}{{ if eq $env "production" }}
      postgres_username: {{ with secret "postgres-production-apps-opendiscussions/creds/opendiscussions" }}{{ .Data.username }}
      postgres_password: {{ .Data.password }}{{ end }}
      {{- end }}
      postgres_port: 5432
ops:
  fetch_open_run_data:
    config:
      outputs_dir: {{ keyOrDefault "edx-pipeline/mit-open/bucket-name" "missing-value-bucket-name" }}/processed/mit-open-course-runs/
  fetch_open_user_data:
    config:
      outputs_dir: {{ keyOrDefault "edx-pipeline/mit-open/bucket-name" "missing-value-bucket-name" }}/raw/mit-open-application-db/auth_user/
  fetch_open_course_data:
    config:
      outputs_dir: {{ keyOrDefault "edx-pipeline/mit-open/bucket-name" "missing-value-bucket-name" }}/processed/mit-open-courses/
  run_open_enrollments_query:
     config:
       athena_mitx_database: ol_warehouse_mitx_{{ keyOrDefault "edx-pipeline/shared/env-suffix" "missing-value-env-suffix" }}
       athena_mitx_enrollments_table: raw_bigquery_mitx_data_user_info_combo
       athena_open_course_runs_table: mit_open_course_runs
       athena_open_courses_table: mit_open_courses
       athena_open_database: ol_warehouse_mit_open_{{ keyOrDefault "edx-pipeline/shared/env-suffix" "missing-value-env-suffix" }}
       athena_open_users_table: raw_mit_open_application_db_auth_users
