---
# This is from tutor environment but it works with the provided dockerfile provided the proper tutor constructed
# directory structure is in place. This is here mostly to just have a record of what I was using.
version: "3.7"
services:
  lms:
    image: ardiea/openedx:testing
    #image: mitodl/final.1
    environment:
      SERVICE_VARIANT: lms
      DJANGO_SETTINGS_MODULE: lms.envs.docker-production
      UWSGI_WORKERS: 2
    restart: unless-stopped
    volumes:
    - ../apps/openedx/settings/lms:/openedx/edx-platform/lms/envs/tutor:ro
    - ../apps/openedx/settings/cms:/openedx/edx-platform/cms/envs/tutor:ro
    - ../apps/openedx/config:/openedx/config:ro
    - ../apps/openedx/uwsgi.ini:/openedx/edx-platform/uwsgi.ini:ro
    - ../../data/lms:/openedx/data
    - ../../data/openedx-media:/openedx/media
    depends_on:
    - lms-permissions
  lms-permissions:
    image: docker.io/overhangio/openedx-permissions:15.3.4
    command: ["1000", "/openedx/data", "/openedx/media"]
    restart: on-failure
    volumes:
    - ../../data/lms:/openedx/data
    - ../../data/openedx-media:/openedx/media
  lms-worker:
    image: ardiea/openedx:testing
    environment:
      SERVICE_VARIANT: lms
      DJANGO_SETTINGS_MODULE: lms.envs.docker-production
    command: celery --app=lms.celery worker --loglevel=info --hostname=edx.lms.core.default.%%h
      --max-tasks-per-child=100 --exclude-queues=edx.cms.core.default
    restart: unless-stopped
    volumes:
    - ../apps/openedx/settings/lms:/openedx/edx-platform/lms/envs/tutor:ro
    - ../apps/openedx/settings/cms:/openedx/edx-platform/cms/envs/tutor:ro
    - ../apps/openedx/config:/openedx/config:ro
    - ../../data/lms:/openedx/data
    - ../../data/openedx-media:/openedx/media
    depends_on:
    - lms
